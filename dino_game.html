<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لعبة الصاروخ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      overflow: hidden;
      background: #000;
      touch-action: none;
    }

    #gameCanvas {
      display: block;
      background: #000;
      cursor: pointer;
    }

    .game-info {
      position: absolute;
      top: 20px;
      right: 20px;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      z-index: 10;
    }

    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      display: none;
      box-shadow: 0 10px 40px rgba(255,255,255,0.3);
      border: 2px solid #f51313;
      z-index: 100;
    }

    .game-over h2 {
      color: #f51313;
      font-size: 48px;
      margin-bottom: 20px;
    }

    .game-over p {
      font-size: 24px;
      margin: 10px 0;
      color: #fff;
    }

    .game-over button {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 20px;
      background: #f51313;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .game-over button:hover {
      background: #ff3333;
    }

    .start-screen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(255,255,255,0.3);
      border: 2px solid #f51313;
      z-index: 100;
    }

    .start-screen h1 {
      color: #f51313;
      font-size: 48px;
      margin-bottom: 20px;
    }

    .start-screen p {
      font-size: 20px;
      margin: 15px 0;
      color: #fff;
    }

    .start-screen button {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 20px;
      background: #f51313;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .start-screen button:hover {
      background: #ff3333;
    }

    @media (max-width: 768px) {
      .game-info {
        font-size: 18px;
        top: 10px;
        right: 10px;
      }
      
      .game-over h2, .start-screen h1 {
        font-size: 32px;
      }
      
      .game-over p, .start-screen p {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="game-info">
    <div>النقاط: <span id="score">0</span></div>
    <div>أعلى نقاط: <span id="highScore">0</span></div>
  </div>

  <div class="start-screen" id="startScreen">
    <h1>🚀 لعبة الصاروخ</h1>
    <p>اضغط مسافة أو حرك الماوس للطيران</p>
    <p>على الموبايل: المس واسحب</p>
    <p>تفادى العوائق واحصل على أعلى النقاط!</p>
    <button onclick="startGame()">ابدأ اللعب</button>
  </div>

  <div class="game-over" id="gameOver">
    <h2>انتهت اللعبة!</h2>
    <p>النقاط: <span id="finalScore">0</span></p>
    <p>أعلى نقاط: <span id="finalHighScore">0</span></p>
    <button onclick="restartGame()">العب مرة أخرى</button>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Set canvas size
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Game variables
    let gameStarted = false;
    let gameRunning = false;
    let score = 0;
    let highScore = 0;
    let gameSpeed = 5;
    let mouseY = canvas.height / 2;
    let targetY = canvas.height / 2;

    // Rocket object (من الملف الأصلي)
    const rocket = {
      x: 150,
      y: canvas.height / 2,
      width: 100,
      height: 50,
      targetY: canvas.height / 2,
      smoothing: 0.1,
      shake: 0,
      
      draw() {
        ctx.save();
        
        // Apply shake effect
        const shakeX = (Math.random() - 0.5) * this.shake;
        const shakeY = (Math.random() - 0.5) * this.shake;
        ctx.translate(this.x + shakeX, this.y + shakeY);
        
        // Flame effects (longfazers من الملف الأصلي)
        this.drawFlames();
        
        // Main rocket body (base من الملف الأصلي)
        ctx.fillStyle = '#f3cfcf';
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(100, -6);
        ctx.lineTo(100, 6);
        ctx.closePath();
        ctx.fill();
        
        // Rocket circle
        ctx.fillStyle = '#f3cfcf';
        ctx.beginPath();
        ctx.arc(110, 0, 11, 0, Math.PI * 2);
        ctx.fill();
        
        // Rocket bottom part
        ctx.beginPath();
        ctx.moveTo(98, 0);
        ctx.lineTo(98, 16);
        ctx.lineTo(43, 0);
        ctx.closePath();
        ctx.fill();
        
        // Top red part (loader span الأحمر)
        ctx.fillStyle = '#f51313';
        ctx.beginPath();
        ctx.moveTo(60, -19);
        ctx.lineTo(95, -19);
        ctx.arcTo(105, -19, 105, -14, 10);
        ctx.lineTo(105, -14);
        ctx.arcTo(105, -18, 95, -18, 1);
        ctx.lineTo(60, -18);
        ctx.closePath();
        ctx.fill();
        
        // Face (face من الملف الأصلي)
        ctx.save();
        ctx.translate(125, -15);
        ctx.rotate(-0.7);
        
        ctx.fillStyle = '#f3cfcf';
        ctx.beginPath();
        ctx.ellipse(0, 0, 10, 6, 0, 0, Math.PI);
        ctx.fill();
        
        // Face red part
        ctx.fillStyle = '#f51313';
        ctx.save();
        ctx.translate(4, 7);
        ctx.rotate(0.7);
        ctx.beginPath();
        ctx.ellipse(0, 0, 6, 6, 0, Math.PI, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
        
        ctx.restore();
        
        // Speed lines (fazer من الملف الأصلي)
        this.drawSpeedLines();
        
        ctx.restore();
      },
      
      drawFlames() {
        const time = Date.now() / 100;
        
        // Long flames (longfazers)
        for (let i = 0; i < 4; i++) {
          const offset = (time + i * 2) % 10;
          const opacity = 1 - offset / 10;
          const length = 30 + Math.random() * 20;
          
          ctx.strokeStyle = `rgba(255, 255, 255, ${opacity * 0.8})`;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(-offset * 15, -15 + i * 10);
          ctx.lineTo(-offset * 15 - length, -15 + i * 10);
          ctx.stroke();
        }
      },
      
      drawSpeedLines() {
        const time = Date.now() / 50;
        
        for (let i = 0; i < 4; i++) {
          const offset = (time + i) % 8;
          const opacity = 1 - offset / 8;
          const startX = 60;
          const y = -19 + i;
          
          ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(startX - offset * 10, y);
          ctx.lineTo(startX - offset * 10 - 30, y);
          ctx.stroke();
        }
      },
      
      update() {
        // Smooth movement
        this.y += (this.targetY - this.y) * this.smoothing;
        
        // Vibration effect
        this.shake = 2;
        
        // Keep in bounds
        if (this.y < 30) this.y = 30;
        if (this.y > canvas.height - 30) this.y = canvas.height - 30;
      }
    };

    // Obstacles array
    let obstacles = [];
    let obstacleTimer = 0;
    let obstacleInterval = 100;

    class Obstacle {
      constructor() {
        this.width = 40;
        this.gap = 200 + Math.random() * 100;
        this.x = canvas.width;
        this.topHeight = 50 + Math.random() * (canvas.height - this.gap - 100);
        this.passed = false;
      }
      
      draw() {
        // Top obstacle
        ctx.fillStyle = '#f51313';
        ctx.fillRect(this.x, 0, this.width, this.topHeight);
        ctx.fillStyle = '#ff3333';
        ctx.fillRect(this.x, this.topHeight - 20, this.width, 20);
        
        // Bottom obstacle
        const bottomY = this.topHeight + this.gap;
        const bottomHeight = canvas.height - bottomY;
        ctx.fillStyle = '#f51313';
        ctx.fillRect(this.x, bottomY, this.width, bottomHeight);
        ctx.fillStyle = '#ff3333';
        ctx.fillRect(this.x, bottomY, this.width, 20);
      }
      
      update() {
        this.x -= gameSpeed;
      }
      
      offScreen() {
        return this.x + this.width < 0;
      }
      
      collidesWith(rocket) {
        const rocketLeft = rocket.x - 10;
        const rocketRight = rocket.x + 120;
        const rocketTop = rocket.y - 20;
        const rocketBottom = rocket.y + 20;
        
        if (rocketRight > this.x && rocketLeft < this.x + this.width) {
          if (rocketTop < this.topHeight || rocketBottom > this.topHeight + this.gap) {
            return true;
          }
        }
        return false;
      }
      
      isPassed(rocket) {
        return !this.passed && this.x + this.width < rocket.x;
      }
    }

    // Stars background
    let stars = [];
    class Star {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2;
        this.speed = 0.5 + Math.random() * 1.5;
      }
      
      draw() {
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(this.x, this.y, this.size, this.size);
      }
      
      update() {
        this.x -= this.speed;
        if (this.x < 0) {
          this.x = canvas.width;
          this.y = Math.random() * canvas.height;
        }
      }
    }

    // Initialize stars
    for (let i = 0; i < 100; i++) {
      stars.push(new Star());
    }

    // Game loop
    function gameLoop() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw and update stars
      stars.forEach(star => {
        star.update();
        star.draw();
      });
      
      if (gameRunning) {
        rocket.targetY = targetY;
        rocket.update();
        
        // Spawn obstacles
        obstacleTimer++;
        if (obstacleTimer > obstacleInterval) {
          obstacles.push(new Obstacle());
          obstacleTimer = 0;
        }
        
        // Update obstacles
        obstacles.forEach((obstacle, index) => {
          obstacle.update();
          obstacle.draw();
          
          // Check collision
          if (obstacle.collidesWith(rocket)) {
            gameOver();
          }
          
          // Check if passed
          if (obstacle.isPassed(rocket)) {
            obstacle.passed = true;
            score++;
            document.getElementById('score').textContent = score;
            
            // Increase difficulty
            if (score % 5 === 0) {
              gameSpeed += 0.3;
              obstacleInterval = Math.max(70, obstacleInterval - 5);
            }
          }
          
          // Remove off-screen obstacles
          if (obstacle.offScreen()) {
            obstacles.splice(index, 1);
          }
        });
      }
      
      rocket.draw();
      
      if (gameStarted) {
        requestAnimationFrame(gameLoop);
      }
    }

    // Start game
    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      gameStarted = true;
      gameRunning = true;
      gameLoop();
    }

    // Game over
    function gameOver() {
      gameRunning = false;
      
      if (score > highScore) {
        highScore = score;
        document.getElementById('highScore').textContent = highScore;
      }
      
      document.getElementById('finalScore').textContent = score;
      document.getElementById('finalHighScore').textContent = highScore;
      document.getElementById('gameOver').style.display = 'block';
    }

    // Restart game
    function restartGame() {
      document.getElementById('gameOver').style.display = 'none';
      
      score = 0;
      gameSpeed = 5;
      obstacles = [];
      obstacleTimer = 0;
      obstacleInterval = 100;
      
      rocket.y = canvas.height / 2;
      rocket.targetY = canvas.height / 2;
      targetY = canvas.height / 2;
      
      document.getElementById('score').textContent = score;
      
      gameRunning = true;
    }

    // Mouse controls
    canvas.addEventListener('mousemove', (e) => {
      if (gameRunning) {
        targetY = e.clientY;
      }
    });

    // Touch controls for mobile
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (gameRunning) {
        targetY = e.touches[0].clientY;
      }
    });

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!gameStarted) {
        startGame();
      } else if (gameRunning) {
        targetY = e.touches[0].clientY;
      }
    });

    // Click to start
    canvas.addEventListener('click', () => {
      if (!gameStarted) {
        startGame();
      }
    });

    // Space to start
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && !gameStarted) {
        e.preventDefault();
        startGame();
      }
    });

    // Initialize rocket position
    window.addEventListener('load', () => {
      rocket.y = canvas.height / 2;
      rocket.targetY = canvas.height / 2;
      targetY = canvas.height / 2;
    });
  </script>
</body>
</html>